"use strict";var ChatbotBundle=(()=>{window.Chatbot={init:function(e){let n={...k(),...e},u=n.theme;u==="auto"&&(u=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),n._resolvedTheme=u,n._themeColors={...f(u),...n.themeColors||{}},F(n),n.theme==="auto"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",r=>{let d=r.matches?"dark":"light";n._resolvedTheme=d,n._themeColors={...f(d),...n.themeColors||{}},F(n)})}};function k(){return{theme:"auto",primaryColor:"#7B3FF2",accentColor:"#3F8CFF",logoUrl:"",botName:"BotStitch Assistant",greeting:"\u{1F44B} Hi there! How can I help you with BotStitch today?",placeholder:"Type your message...",position:"bottom-right",showBranding:!0,webhookUrl:"",premium:!1}}function f(e){return e==="dark"?{bg:"#181A20",msgBg:"#23262F",headerBg:"linear-gradient(90deg, #23286B, #3F8CFF)",text:"#F3F6FC",accent:"#3F8CFF",userMsgBg:"#23262F",userMsgText:"#F3F6FC",botMsgBg:"#2D3748",botMsgText:"#F3F6FC",inputBg:"#23262F",inputText:"#F3F6FC",border:"#23262F",sendBtn:"#3F8CFF"}:{bg:"#fff",msgBg:"#f9fafb",headerBg:"linear-gradient(90deg, #7B3FF2, #3F8CFF)",text:"#222",accent:"#7B3FF2",userMsgBg:"#f3f4f6",userMsgText:"#222",botMsgBg:"#7B3FF2",botMsgText:"#fff",inputBg:"#fff",inputText:"#222",border:"#e5e7eb",sendBtn:"#7B3FF2"}}function w(){let e=localStorage.getItem("botstitch_session_id");return e||(e="sess_"+Math.random().toString(36).substr(2,12)+"_"+Date.now(),localStorage.setItem("botstitch_session_id",e)),e}function v(){let e=navigator.userAgent;return/Mobi|Android/i.test(e)?"mobile":"desktop"}function F(e){let n=document.getElementById("botstitch-widget-container");n&&n.remove();let u=e._resolvedTheme,r=e._themeColors,d=document.createElement("div");d.id="botstitch-widget-container",d.style.position="fixed",d.style[e.position.split("-")[1]]="24px",d.style[e.position.split("-")[0]]="24px",d.style.zIndex=9999;let s=document.createElement("button");s.id="botstitch-bubble",s.style.background=r.headerBg,s.style.width=s.style.height="56px",s.style.borderRadius="50%",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.boxShadow="0 4px 16px rgba(0,0,0,0.18)",s.style.cursor="pointer",s.style.transition="transform 0.2s",s.onmouseenter=()=>s.style.transform="scale(1.08)",s.onmouseleave=()=>s.style.transform="scale(1)",s.innerHTML=e.logoUrl&&e.premium?`<img src="${e.logoUrl}" alt="logo" style="width:32px;height:32px;border-radius:8px;" />`:'<svg width="28" height="28" fill="none" stroke="#fff" stroke-width="2"><circle cx="14" cy="14" r="12" /></svg>';let t=document.createElement("div");t.id="botstitch-chat-window",t.style.display="none",t.style.width="360px",t.style.maxWidth="95vw",t.style.height="480px",t.style.maxHeight="80vh",t.style.background=r.bg,t.style.borderRadius="18px",t.style.boxShadow="0 8px 32px rgba(0,0,0,0.16)",t.style.position="absolute",t.style.bottom="72px",t.style.right="0",t.style.overflow="hidden",t.style.display="flex",t.style.flexDirection="column",t.style.transition="opacity 0.2s";let p=document.createElement("div");p.style.background=r.headerBg,p.style.color=r.text,p.style.padding="16px",p.style.display="flex",p.style.alignItems="center",p.style.justifyContent="space-between",p.innerHTML=`
    <div style="display:flex;align-items:center;gap:10px;">
      ${e.logoUrl&&e.premium?`<img src="${e.logoUrl}" alt="logo" style="width:32px;height:32px;border-radius:8px;" />`:'<svg width="28" height="28" fill="none" stroke="#fff" stroke-width="2"><circle cx="14" cy="14" r="12" /></svg>'}
      <div>
        <div style="font-weight:600;font-size:16px;">${e.botName}</div>
        <div style="font-size:12px;opacity:0.85;">Online now</div>
      </div>
    </div>
    <button id="botstitch-close-btn" style="background:none;border:none;color:#fff;cursor:pointer;font-size:22px;">&times;</button>
  `;let i=document.createElement("div");i.id="botstitch-messages",i.style.flex="1",i.style.padding="16px",i.style.overflowY="auto",i.style.background=r.msgBg,i.innerHTML=`<div class="bot-msg" style="background:${r.botMsgBg};color:${r.botMsgText};padding:12px 16px;border-radius:14px 14px 4px 14px;max-width:80%;margin-bottom:8px;">${e.greeting}</div>`;let c=document.createElement("div");c.style.padding="16px",c.style.borderTop=`1px solid ${r.border}`,c.style.background=r.inputBg,c.innerHTML=`
    <div style="display:flex;gap:8px;align-items:center;">
      <input id="botstitch-input" type="text" placeholder="${e.placeholder}" style="flex:1;padding:10px 14px;border:1px solid ${r.border};border-radius:8px;font-size:15px;outline:none;background:${r.inputBg};color:${r.inputText};" />
      <input id="botstitch-file" type="file" style="display:none;" ${e.premium?"multiple":""} accept=".jpg,.jpeg,.png,.pdf,.doc,.docx" />
      <button id="botstitch-attach" title="Attach file" style="background:none;border:none;cursor:pointer;font-size:18px;color:${r.accent};"><svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 13V7a5 5 0 0 1 10 0v6a5 5 0 0 1-10 0V8"/></svg></button>
      <button id="botstitch-send" style="background:${r.sendBtn};color:#fff;border:none;padding:10px 18px;border-radius:8px;cursor:pointer;font-weight:500;font-size:15px;">Send</button>
    </div>
  `;let g="";e.premium?e.showFooter&&e.footer?g=`<span>${e.footer}</span>`:g="":g="<span>Powered by BotStitch</span>";let h=document.createElement("div");if(h.style.padding="8px 0 12px 0",h.style.textAlign="center",h.style.fontSize="12px",h.style.color="#aaa",h.innerHTML=g,e.premium){let l=document.createElement("input");l.type="file",l.accept="image/*",l.style.margin="8px 0 0 16px",l.onchange=a=>{alert("Logo upload is handled in the dashboard for premium users.")},p.appendChild(l)}t.appendChild(p),t.appendChild(i),t.appendChild(c),t.appendChild(h),d.appendChild(s),d.appendChild(t),document.body.appendChild(d),s.onclick=()=>{t.style.display=t.style.display==="none"?"flex":"none",t.style.display==="flex"?setTimeout(()=>t.style.opacity="1",10):t.style.opacity="0"},p.querySelector("#botstitch-close-btn").onclick=()=>{t.style.display="none"},c.querySelector("#botstitch-attach").onclick=()=>{c.querySelector("#botstitch-file").click()},c.querySelector("#botstitch-file").onchange=async l=>{let a=Array.from(l.target.files);if(!a.length)return;let y=[];for(let m of a){let o=new FormData;o.append("file",m),o.append("sessionId",w()),o.append("timestamp",new Date().toISOString()),o.append("source","web"),o.append("userAgent",navigator.userAgent),o.append("platform",v()),o.append("metadata",JSON.stringify(e.metadata||{}));let C=e.n8nChatUrl||e.webhookUrl;try{let x=await fetch(C,{method:"POST",body:o});if(x.ok){let b=await x.json();b.fileUrl&&y.push(b.fileUrl)}}catch(x){}}y.forEach(m=>{let o=document.createElement("div");o.className="user-msg",o.style.background=e._themeColors.userMsgBg,o.style.color=e._themeColors.userMsgText,o.style.padding="12px 16px",o.style.borderRadius="14px 14px 14px 4px",o.style.maxWidth="80%",o.style.margin="8px 0 8px auto",o.innerHTML=`<a href="${m}" target="_blank" rel="noopener">\u{1F4CE} File</a>`,i.appendChild(o),i.scrollTop=i.scrollHeight}),l.target.value=""},c.querySelector("#botstitch-send").onclick=async()=>{let l=c.querySelector("#botstitch-input");if(l.value.trim()){let a=document.createElement("div");a.className="user-msg",a.style.background=e._themeColors.userMsgBg,a.style.color=e._themeColors.userMsgText,a.style.padding="12px 16px",a.style.borderRadius="14px 14px 14px 4px",a.style.maxWidth="80%",a.style.margin="8px 0 8px auto",a.innerText=l.value,i.appendChild(a),i.scrollTop=i.scrollHeight;let y={message:l.value,sessionId:w(),timestamp:new Date().toISOString(),source:"web",userAgent:navigator.userAgent,platform:v(),metadata:e.metadata||{},fileUrls:[]},m=e.n8nChatUrl||e.webhookUrl;try{await fetch(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)})}catch(o){}l.value=""}}}})();
